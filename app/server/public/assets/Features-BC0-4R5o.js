import{j as e}from"./vendor-ui-K43rUeTs.js";import{r as l,L as S}from"./vendor-react-Dlyf-RJj.js";import{c as I,u as U}from"./index-CAGaxXNg.js";const x="",A={submitted:"bg-gray-100 text-gray-800",under_review:"bg-blue-100 text-blue-800",planned:"bg-purple-100 text-purple-800",in_progress:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",declined:"bg-red-100 text-red-800"},q={submitted:"Submitted",under_review:"Under Review",planned:"Planned",in_progress:"In Progress",completed:"Completed",declined:"Declined"},j={general:"General",jobs:"Jobs",employers:"Employers",jobseekers:"Jobseekers",transparency:"Transparency",mobile:"Mobile",other:"Other"};function G(){const o=I(),{user:c,token:i}=U(),[k,D]=l.useState([]),[u,B]=l.useState({total:0,planned:0,inProgress:0,completed:0,yourVotes:0}),[R,z]=l.useState(!0),[d,h]=l.useState("all"),[p,M]=l.useState("all"),[f,T]=l.useState("votes"),[v,F]=l.useState(!1),[a,N]=l.useState(null),[w,O]=l.useState([]),[$,L]=l.useState(""),[m,g]=l.useState({title:"",description:"",category:"general"});l.useEffect(()=>{b(),C()},[d,p,f,i]);const b=async()=>{try{const t=new URLSearchParams;d!=="all"&&t.append("status",d),p!=="all"&&t.append("category",p),t.append("sort",f);const s=i?{Authorization:`Bearer ${i}`}:{},n=await fetch(`${x}/api/features?${t}`,{headers:s});if(!n.ok)throw new Error("Failed");D(await n.json())}catch(t){console.error("Failed to load features:",t),o.error("Failed to load feature requests")}finally{z(!1)}},C=async()=>{try{const t=i?{Authorization:`Bearer ${i}`}:{},s=await fetch(`${x}/api/features/stats`,{headers:t});s.ok&&B(await s.json())}catch(t){console.error("Failed to load stats:",t)}},_=async t=>{var s,n;if(!c){o.error("Please log in to vote");return}try{const r=await fetch(`${x}/api/features/${t}/vote`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),y=await r.json();if(!r.ok)throw{response:{data:y}};o.success(y.message),b(),C()}catch(r){o.error(((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.error)||"Failed to vote")}},V=async t=>{var s,n;if(t.preventDefault(),!c){o.error("Please log in to submit a feature request");return}try{const r=await fetch(`${x}/api/features`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!r.ok)throw{response:{data:await r.json()}};o.success("Feature request submitted!"),F(!1),g({title:"",description:"",category:"general"}),b(),C()}catch(r){o.error(((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.error)||"Failed to submit feature request")}},P=async t=>{try{const s=await fetch(`${x}/api/features/${t}/comments`);s.ok&&O(await s.json())}catch(s){console.error("Failed to load comments:",s)}},E=async t=>{var s,n;if(t.preventDefault(),!c){o.error("Please log in to comment");return}try{const r=await fetch(`${x}/api/features/${a.id}/comment`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({comment:$})});if(!r.ok)throw{response:{data:await r.json()}};o.success("Comment added!"),L(""),P(a.id),b()}catch(r){o.error(((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.error)||"Failed to add comment")}},J=t=>{N(t),P(t.id)};return e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Community Feature Requests"}),e.jsx("p",{className:"text-gray-600",children:"Share your ideas and vote on features you'd like to see in WantokJobs!"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:u.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Requests"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:u.planned}),e.jsx("div",{className:"text-sm text-gray-600",children:"Planned"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:u.inProgress}),e.jsx("div",{className:"text-sm text-gray-600",children:"In Progress"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.completed}),e.jsx("div",{className:"text-sm text-gray-600",children:"Completed"})]}),c&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:u.yourVotes}),e.jsx("div",{className:"text-sm text-gray-600",children:"Your Votes"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:()=>F(!v),className:"bg-primary-600 text-white px-6 py-3 rounded-lg hover:bg-primary-700 transition font-semibold",children:v?"Cancel":"+ Submit a Request"})}),v&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Submit a Feature Request"}),c?e.jsxs("form",{onSubmit:V,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:m.title,onChange:t=>g({...m,title:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Short, clear title for your request",required:!0,minLength:5,maxLength:200})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{value:m.description,onChange:t=>g({...m,description:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Describe your idea in detail...",rows:5,required:!0,minLength:20,maxLength:2e3})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsx("select",{value:m.category,onChange:t=>g({...m,category:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:Object.entries(j).map(([t,s])=>e.jsx("option",{value:t,children:s},t))})]}),e.jsx("button",{type:"submit",className:"bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 transition",children:"Submit Request"})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"You need to be logged in to submit a request"}),e.jsx(S,{to:"/login",className:"text-primary-600 hover:underline",children:"Log in"})," or ",e.jsx(S,{to:"/register",className:"text-primary-600 hover:underline",children:"Sign up"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Status"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>h("all"),className:`px-3 py-1 rounded-full text-sm ${d==="all"?"bg-primary-600 text-white":"bg-gray-200 text-gray-700"}`,children:"All"}),e.jsx("button",{onClick:()=>h("submitted"),className:`px-3 py-1 rounded-full text-sm ${d==="submitted"?"bg-primary-600 text-white":"bg-gray-200 text-gray-700"}`,children:"Most Voted"}),e.jsx("button",{onClick:()=>h("planned"),className:`px-3 py-1 rounded-full text-sm ${d==="planned"?"bg-primary-600 text-white":"bg-gray-200 text-gray-700"}`,children:"Planned"}),e.jsx("button",{onClick:()=>h("in_progress"),className:`px-3 py-1 rounded-full text-sm ${d==="in_progress"?"bg-primary-600 text-white":"bg-gray-200 text-gray-700"}`,children:"In Progress"}),e.jsx("button",{onClick:()=>h("completed"),className:`px-3 py-1 rounded-full text-sm ${d==="completed"?"bg-primary-600 text-white":"bg-gray-200 text-gray-700"}`,children:"Completed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:p,onChange:t=>M(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:"All Categories"}),Object.entries(j).map(([t,s])=>e.jsx("option",{value:t,children:s},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:f,onChange:t=>T(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"votes",children:"Most Voted"}),e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"oldest",children:"Oldest First"})]})]})]})}),R?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"})}):k.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:e.jsx("p",{className:"text-gray-600",children:"No feature requests found with the current filters."})}):e.jsx("div",{className:"space-y-4",children:k.map(t=>e.jsx("div",{className:"bg-white rounded-lg shadow hover:shadow-md transition p-6 cursor-pointer",onClick:()=>J(t),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("button",{onClick:s=>{s.stopPropagation(),_(t.id)},className:`flex flex-col items-center justify-center w-16 h-16 rounded-lg transition ${t.user_voted?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"})}),e.jsx("span",{className:"text-xs font-bold mt-1",children:t.vote_count})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1",children:t.title}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${A[t.status]}`,children:q[t.status]}),e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-700",children:j[t.category]})]})]}),e.jsx("p",{className:"text-gray-600 mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["Submitted by ",t.submitter_name]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString()}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[t.comment_count," comments"]})]}),t.considered&&e.jsx("div",{className:"mt-2 inline-flex items-center gap-1 px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium",children:"ðŸ”¥ Considered for implementation!"}),t.admin_response&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xs font-semibold text-blue-900 mb-1",children:"Admin Response:"}),e.jsx("p",{className:"text-sm text-blue-800",children:t.admin_response})]})]})]})},t.id))}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>N(null),children:e.jsx("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:a.title}),e.jsx("button",{onClick:()=>N(null),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("span",{className:`px-3 py-1 rounded text-sm font-medium ${A[a.status]}`,children:q[a.status]}),e.jsx("span",{className:"px-3 py-1 rounded text-sm font-medium bg-gray-100 text-gray-700",children:j[a.category]})]}),e.jsx("p",{className:"text-gray-700 mb-4 whitespace-pre-wrap",children:a.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-4",children:[e.jsxs("span",{children:["Submitted by ",a.submitter_name]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(a.created_at).toLocaleDateString()})]}),e.jsxs("button",{onClick:()=>_(a.id),className:`mb-6 px-6 py-2 rounded-lg transition flex items-center gap-2 ${a.user_voted?"bg-primary-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"})}),a.user_voted?"Unvote":"Vote"," (",a.vote_count,")"]}),a.admin_response&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Admin Response:"}),e.jsx("p",{className:"text-blue-800",children:a.admin_response})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Comments (",w.length,")"]}),c&&e.jsxs("form",{onSubmit:E,className:"mb-6",children:[e.jsx("textarea",{value:$,onChange:t=>L(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 mb-2",placeholder:"Add a comment...",rows:3,required:!0,minLength:3,maxLength:1e3}),e.jsx("button",{type:"submit",className:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition",children:"Post Comment"})]}),!c&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg text-center",children:[e.jsx(S,{to:"/login",className:"text-primary-600 hover:underline",children:"Log in"})," to comment"]}),e.jsxs("div",{className:"space-y-4",children:[w.map(t=>e.jsxs("div",{className:"border-l-2 border-gray-200 pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1",children:[e.jsx("span",{className:"font-semibold",children:t.commenter_name}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString()})]}),e.jsx("p",{className:"text-gray-700",children:t.comment})]},t.id)),w.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No comments yet. Be the first!"})]})]})]})})})]})}export{G as default};
