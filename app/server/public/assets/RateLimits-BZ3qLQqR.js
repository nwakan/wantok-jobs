import{j as e,a_ as y,a$ as k,b0 as N,b1 as u,b2 as f,b3 as w,b4 as v}from"./vendor-ui-K43rUeTs.js";import{r as l}from"./vendor-react-Dlyf-RJj.js";import{a as h}from"./index-CAGaxXNg.js";function C(){var n,o,x;const[s,m]=l.useState(null),[p,b]=l.useState(!0),[c,i]=l.useState(null),r=l.useCallback(async()=>{var t,a;try{const d=await h.get("/api/admin/rate-limits");m(d.data),i(null)}catch(d){i(((a=(t=d.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to load data")}finally{b(!1)}},[]);l.useEffect(()=>{r();const t=setInterval(r,3e4);return()=>clearInterval(t)},[r]);const j=async t=>{try{await h.post(`/api/admin/rate-limits/unlock/${t}`),r()}catch{alert("Failed to unlock account")}};if(p)return e.jsx("div",{className:"p-6",children:"Loading..."});if(c)return e.jsx("div",{className:"p-6 text-red-600",children:c});const g=((s==null?void 0:s.blocksByHour)||[]).map(t=>({...t,label:t.hour.slice(11,16)}));return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-white",children:"ðŸ›¡ï¸ Rate Limit Monitor"}),e.jsx("button",{onClick:r,className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700",children:"Refresh"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:e.jsxs("p",{className:"text-lg font-semibold dark:text-white",children:["Total blocks (24h): ",e.jsx("span",{className:"text-red-600",children:(s==null?void 0:s.totalBlocks24h)||0})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 dark:text-white",children:"Blocks per Hour (24h)"}),e.jsx(y,{width:"100%",height:250,children:e.jsxs(k,{data:g,children:[e.jsx(N,{strokeDasharray:"3 3"}),e.jsx(u,{dataKey:"label",tick:{fontSize:11}}),e.jsx(f,{allowDecimals:!1}),e.jsx(w,{}),e.jsx(v,{dataKey:"count",fill:"#ef4444",radius:[4,4,0,0]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4 overflow-x-auto",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 dark:text-white",children:"Top Blocked IPs"}),(n=s==null?void 0:s.topBlockedIPs)!=null&&n.length?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 dark:text-gray-400 border-b dark:border-gray-700",children:[e.jsx("th",{className:"pb-2 pr-4",children:"IP"}),e.jsx("th",{className:"pb-2 pr-4",children:"Count"}),e.jsx("th",{className:"pb-2 pr-4",children:"Last Endpoint"}),e.jsx("th",{className:"pb-2",children:"Last Time"})]})}),e.jsx("tbody",{children:s.topBlockedIPs.map((t,a)=>e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("td",{className:"py-2 pr-4 font-mono dark:text-gray-300",children:t.ip}),e.jsx("td",{className:"py-2 pr-4 dark:text-gray-300",children:t.count}),e.jsx("td",{className:"py-2 pr-4 dark:text-gray-300 truncate max-w-[200px]",children:t.lastEndpoint}),e.jsx("td",{className:"py-2 dark:text-gray-300",children:new Date(t.lastTime).toLocaleString()})]},a))})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocked IPs in last 24h"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4 overflow-x-auto",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 dark:text-white",children:"Top Hit Endpoints"}),(o=s==null?void 0:s.topEndpoints)!=null&&o.length?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 dark:text-gray-400 border-b dark:border-gray-700",children:[e.jsx("th",{className:"pb-2 pr-4",children:"Endpoint"}),e.jsx("th",{className:"pb-2",children:"Blocks"})]})}),e.jsx("tbody",{children:s.topEndpoints.map((t,a)=>e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("td",{className:"py-2 pr-4 font-mono dark:text-gray-300",children:t.endpoint}),e.jsx("td",{className:"py-2 dark:text-gray-300",children:t.count})]},a))})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No endpoint hits in last 24h"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4 overflow-x-auto",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 dark:text-white",children:"Active Account Lockouts"}),(x=s==null?void 0:s.activeLockouts)!=null&&x.length?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 dark:text-gray-400 border-b dark:border-gray-700",children:[e.jsx("th",{className:"pb-2 pr-4",children:"User"}),e.jsx("th",{className:"pb-2 pr-4",children:"Email"}),e.jsx("th",{className:"pb-2 pr-4",children:"Locked Until"}),e.jsx("th",{className:"pb-2",children:"Action"})]})}),e.jsx("tbody",{children:s.activeLockouts.map(t=>e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("td",{className:"py-2 pr-4 dark:text-gray-300",children:t.name}),e.jsx("td",{className:"py-2 pr-4 dark:text-gray-300",children:t.email}),e.jsx("td",{className:"py-2 pr-4 dark:text-gray-300",children:new Date(t.lockout_until).toLocaleString()}),e.jsx("td",{className:"py-2",children:e.jsx("button",{onClick:()=>j(t.id),className:"px-2 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700",children:"Unlock"})})]},t.id))})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No active lockouts"})]})]})}export{C as default};
