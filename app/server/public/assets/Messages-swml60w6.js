import{r,Y as b,ad as o,j as e}from"./index-BNk0NZme.js";function j(){const[l,n]=r.useState([]),[s,p]=r.useState(null),[x,u]=r.useState(!0),{showToast:c}=b(),[m,i]=r.useState("");r.useEffect(()=>{y()},[]);const y=async()=>{try{const t=await o.getAll();n(t||[])}catch(t){console.error("Failed to load messages:",t),n([{id:1,from_name:"Tech Corp",subject:"Application Update - Senior Developer Position",message:"Thank you for applying. We would like to schedule an interview...",read:!1,created_at:new Date().toISOString(),from_type:"employer"},{id:2,from_name:"Admin Team",subject:"Welcome to WantokJobs!",message:"Thank you for registering. Here are some tips to get started...",read:!0,created_at:new Date(Date.now()-864e5).toISOString(),from_type:"admin"},{id:3,from_name:"StartUp Inc",subject:"Interview Invitation",message:"We are impressed with your profile and would like to invite you for an interview...",read:!0,created_at:new Date(Date.now()-1728e5).toISOString(),from_type:"employer"}])}finally{u(!1)}},h=async t=>{if(p(t),i(""),!t.read)try{await o.markRead(t.id),n(l.map(a=>a.id===t.id?{...a,read:!0}:a))}catch(a){console.error("Failed to mark as read:",a)}},g=async t=>{t.preventDefault();try{await o.send({recipient_id:s.from_id,subject:`Re: ${s.subject}`,message:m}),c("Reply sent successfully","success"),i("")}catch{c("Failed to send reply","error")}},d=l.filter(t=>!t.read).length;return x?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Messages"}),d>0&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[d," unread message",d!==1?"s":""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"divide-y divide-gray-200",children:l.length===0?e.jsx("p",{className:"p-6 text-center text-gray-500",children:"No messages"}):l.map(t=>e.jsxs("div",{onClick:()=>h(t),className:`p-4 cursor-pointer transition-colors ${t.read?"hover:bg-gray-50":"bg-blue-50"} ${(s==null?void 0:s.id)===t.id?"bg-gray-100":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("p",{className:`font-semibold text-sm ${t.read?"text-gray-700":"text-gray-900"}`,children:t.from_name}),!t.read&&e.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full"})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:t.subject}),e.jsx("p",{className:"text-xs text-gray-500 truncate mb-1",children:t.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t.from_type==="admin"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:t.from_type==="admin"?"Admin":"Employer"}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(t.created_at).toLocaleDateString()})]})]},t.id))})}),e.jsx("div",{className:"lg:col-span-2 bg-white rounded-lg shadow-sm p-6",children:s?e.jsxs("div",{children:[e.jsxs("div",{className:"border-b pb-4 mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:s.subject}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:s.from_name}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:new Date(s.created_at).toLocaleString()}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.from_type==="admin"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:s.from_type==="admin"?"Admin":"Employer"})]})]}),e.jsx("div",{className:"prose max-w-none mb-6",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.message})}),s.from_type!=="admin"&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Reply"}),e.jsxs("form",{onSubmit:g,children:[e.jsx("textarea",{value:m,onChange:t=>i(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg mb-4",rows:"6",placeholder:"Type your reply here...",required:!0}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Send Reply"})]})]}),s.from_type==="admin"&&e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsx("p",{className:"text-purple-800 text-sm",children:"ℹ️ This is a system message from the admin team. You cannot reply directly."})})]}):e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Select a message to view"})})]})]})}export{j as default};
