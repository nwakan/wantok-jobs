import{j as e,aT as C,R as k,B as P,aM as D,aU as T,aV as E}from"./vendor-ui-K43rUeTs.js";import{r as a}from"./vendor-react-Dlyf-RJj.js";const L="/api";async function d(t,l={}){const i=localStorage.getItem("token"),r=await fetch(`${L}${t}`,{...l,headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json",...l.headers}});if(!r.ok)throw new Error(`API error ${r.status}`);return r.json()}const c={bank:"BSP",accountName:"WantokJobs Ltd",accountNumber:"7001234567",branch:"Waigani"};function j(t){return`K${Number(t||0).toFixed(2)}`}function R(t){return t?new Date(t).toLocaleDateString("en-PG",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function I(){const[t,l]=a.useState(null),[i,r]=a.useState([]),[w,m]=a.useState(!0),[x,u]=a.useState(null),[v,h]=a.useState(!1),[n,p]=a.useState(""),[o,y]=a.useState(null),[g,b]=a.useState(!1);a.useEffect(()=>{f()},[]);async function f(){m(!0),u(null);try{const[s,N]=await Promise.all([d("/wallet"),d("/wallet/transactions")]);l(s.data||s),r((N.data||N.transactions||[]).slice(0,30))}catch(s){u(s.message)}finally{m(!1)}}async function B(){if(!(!n||Number(n)<=0)){b(!0);try{const s=await d("/wallet/deposit",{method:"POST",body:JSON.stringify({amount:Number(n)})});y(s.data||s),p("")}catch(s){alert("Failed: "+s.message)}finally{b(!1)}}}if(w)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})});if(x)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:x});const S=(t==null?void 0:t.balance)||0,A=(t==null?void 0:t.alert_credits)??S;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(C,{className:"w-7 h-7 text-primary-600"})," My Wallet"]}),e.jsx("button",{onClick:f,className:"text-gray-500 hover:text-gray-700",children:e.jsx(k,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 rounded-xl p-6 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(P,{className:"w-5 h-5 opacity-80"}),e.jsx("p",{className:"text-sm opacity-80",children:"Alert Credits"})]}),e.jsx("p",{className:"text-4xl font-bold",children:j(A)}),e.jsx("p",{className:"text-sm opacity-70 mt-1",children:"Use credits to set up job alerts and premium features"}),e.jsxs("button",{onClick:()=>{h(!0),y(null)},className:"mt-4 bg-white text-primary-700 px-4 py-2 rounded-lg font-semibold hover:bg-primary-50 transition flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"})," Buy More Credits"]})]}),v&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Buy Credits"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600 text-xl",children:"×"})]}),o?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-sm text-green-700 space-y-1",children:[e.jsx("p",{className:"font-semibold text-green-800 mb-2",children:"Transfer to:"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Bank:"})," ",c.bank]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Account Name:"})," ",c.accountName]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Account Number:"})," ",c.accountNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Branch:"})," ",c.branch]}),e.jsxs("p",{className:"mt-2",children:[e.jsx("span",{className:"font-medium",children:"Reference:"})," ",e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded font-mono text-green-900",children:o.reference||o.id||"—"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Credits added once payment is confirmed."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Amount (PGK)"}),e.jsx("input",{type:"number",min:"1",value:n,onChange:s=>p(s.target.value),placeholder:"e.g. 50",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}),e.jsx("button",{onClick:B,disabled:g||!n,className:"w-full bg-primary-600 text-white py-2 rounded-lg font-semibold hover:bg-primary-700 disabled:opacity-50 transition",children:g?"Processing…":"Get Payment Details"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:[e.jsx("h3",{className:"px-4 py-3 font-semibold text-gray-800 border-b border-gray-100",children:"Transaction History"}),i.length===0?e.jsx("p",{className:"p-4 text-gray-500 text-sm",children:"No transactions yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Type"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Description"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:i.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-500",children:R(s.created_at)}),e.jsxs("td",{className:"px-4 py-2 capitalize flex items-center gap-1",children:[Number(s.amount)>=0?e.jsx(T,{className:"w-4 h-4 text-green-500"}):e.jsx(E,{className:"w-4 h-4 text-red-500"}),s.type]}),e.jsxs("td",{className:`px-4 py-2 text-right font-medium ${Number(s.amount)>=0?"text-green-600":"text-red-600"}`,children:[Number(s.amount)>=0?"+":"",j(s.amount)]}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:s.description||"—"})]},s.id))})]})})]})]})}export{I as default};
