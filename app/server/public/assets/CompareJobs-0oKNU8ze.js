import{j as e,al as E,aM as b,X as v,S as R}from"./vendor-ui-K43rUeTs.js";import{c as A,r as o,L as k}from"./vendor-react-Dlyf-RJj.js";import{P as D}from"./index-CAGaxXNg.js";const J="/api",F=[{key:"title",label:"Job Title"},{key:"company_name",label:"Company"},{key:"location",label:"Location"},{key:"salary",label:"Salary",render:t=>t.salary_min&&t.salary_max?`${t.salary_currency||"PGK"} ${t.salary_min.toLocaleString()} - ${t.salary_max.toLocaleString()}`:"Not specified"},{key:"job_type",label:"Job Type"},{key:"experience_level",label:"Experience"},{key:"categories",label:"Category",render:t=>{var n;return((n=t.categories)==null?void 0:n.map(l=>l.name).join(", "))||"Uncategorized"}},{key:"benefits",label:"Benefits",render:t=>t.benefits||"Not listed"},{key:"created_at",label:"Posted",render:t=>t.created_at?new Date(t.created_at).toLocaleDateString():"-"}];function C(t){return t.salary_max||t.salary_min||0}function G(){var S;const[t,n]=A(),[l,x]=o.useState([]),[y,p]=o.useState(!1),[_,i]=o.useState(!1),[g,u]=o.useState(""),[j,d]=o.useState([]),[f,N]=o.useState(!1),c=((S=t.get("jobs"))==null?void 0:S.split(",").filter(Boolean).map(Number))||[],P=o.useCallback(async s=>{if(!s.length){x([]);return}p(!0);try{const r=await(await fetch(`${J}/jobs/compare?ids=${s.join(",")}`)).json();x(s.map(m=>r.find(h=>h.id===m)).filter(Boolean))}catch{x([])}p(!1)},[]);o.useEffect(()=>{if(!c.length){const s=JSON.parse(sessionStorage.getItem("compareJobs")||"[]");if(s.length>=2){n({jobs:s.join(",")},{replace:!0});return}}P(c)},[t.get("jobs")]);const L=s=>{const a=c.filter(r=>r!==s);a.length?n({jobs:a.join(",")}):n({}),sessionStorage.setItem("compareJobs",JSON.stringify(a))},$=s=>{if(c.includes(s)||c.length>=3)return;const a=[...c,s];n({jobs:a.join(",")}),sessionStorage.setItem("compareJobs",JSON.stringify(a)),i(!1),u(""),d([])},I=async s=>{if(u(s),s.length<2){d([]);return}N(!0);try{const r=await(await fetch(`${J}/jobs?search=${encodeURIComponent(s)}&limit=8`)).json();d((r.jobs||r).filter(m=>!c.includes(m.id)))}catch{d([])}N(!1)},w=Math.max(...l.map(C),0),B=(s,a)=>a.render?a.render(s):s[a.key]||"-";return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx(D,{title:"Compare Jobs",description:"Compare jobs side by side on WantokJobs"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs(k,{to:"/jobs",className:"text-primary-600 hover:text-primary-700 text-sm flex items-center gap-1 mb-3",children:[e.jsx(E,{className:"w-4 h-4"})," Back to Jobs"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Compare Jobs"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Compare up to 3 jobs side by side"})]}),l.length===0&&!y&&e.jsxs("div",{className:"text-center py-16 bg-white rounded-xl border border-gray-200",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No jobs selected for comparison"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Select jobs from the job listings using the compare checkbox, or search below"}),e.jsxs("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[e.jsx(b,{className:"w-4 h-4 inline mr-1"})," Add Job"]})]}),y?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):l.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-left text-sm font-medium text-gray-500 bg-gray-50 w-36 rounded-tl-xl",children:"Field"}),l.map(s=>e.jsx("th",{className:"p-4 bg-gray-50 min-w-[220px]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{to:`/jobs/${s.id}`,className:"text-primary-600 hover:underline text-sm font-semibold truncate",children:s.title}),e.jsx("button",{onClick:()=>L(s.id),className:"text-gray-400 hover:text-red-500 ml-2",title:"Remove",children:e.jsx(v,{className:"w-4 h-4"})})]})},s.id)),l.length<3&&e.jsx("th",{className:"p-4 bg-gray-50 min-w-[180px] rounded-tr-xl",children:e.jsxs("button",{onClick:()=>i(!0),className:"text-primary-600 hover:text-primary-700 text-sm flex items-center gap-1 mx-auto",children:[e.jsx(b,{className:"w-4 h-4"})," Add Job"]})})]})}),e.jsx("tbody",{children:F.map((s,a)=>e.jsxs("tr",{className:a%2===0?"bg-white":"bg-gray-50/50",children:[e.jsx("td",{className:"p-4 text-sm font-medium text-gray-600 border-t border-gray-100",children:s.label}),l.map(r=>{const m=B(r,s),h=s.key==="salary"&&w>0&&C(r)===w;return e.jsx("td",{className:`p-4 text-sm border-t border-gray-100 ${h?"text-green-700 font-semibold bg-green-50":"text-gray-800"}`,children:m},r.id)}),l.length<3&&e.jsx("td",{className:"p-4 border-t border-gray-100"})]},s.key))})]})}),_&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-start justify-center pt-24",onClick:()=>i(!1),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md mx-4 p-4",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(R,{className:"w-5 h-5 text-gray-400"}),e.jsx("input",{autoFocus:!0,type:"text",value:g,onChange:s=>I(s.target.value),placeholder:"Search jobs to compare...",className:"flex-1 outline-none text-sm"}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(v,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto",children:[f&&e.jsx("p",{className:"text-sm text-gray-400 p-2",children:"Searching..."}),j.map(s=>e.jsxs("button",{onClick:()=>$(s.id),className:"w-full text-left p-3 hover:bg-gray-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.company_name||"Company"," Â· ",s.location||"PNG"]})]}),e.jsx(b,{className:"w-4 h-4 text-primary-600"})]},s.id)),g.length>=2&&!f&&j.length===0&&e.jsx("p",{className:"text-sm text-gray-400 p-2",children:"No results"})]})]})})]})}export{G as default};
