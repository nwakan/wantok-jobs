import{j as e,aT as q,R as p,aM as E,p as L,ap as M,aU as R,aV as W}from"./vendor-ui-K43rUeTs.js";import{r as a}from"./vendor-react-Dlyf-RJj.js";const U="/api";async function o(t,d={}){const r=localStorage.getItem("token"),i=await fetch(`${U}${t}`,{...d,headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",...d.headers}});if(!i.ok)throw new Error(`API error ${i.status}`);return i.json()}const m={bank:"BSP",accountName:"WantokJobs Ltd",accountNumber:"7001234567",branch:"Waigani"};function l(t){return`K${Number(t||0).toFixed(2)}`}function A(t){return t?new Date(t).toLocaleDateString("en-PG",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}const I={deposit:e.jsx(R,{className:"w-4 h-4 text-green-500"}),debit:e.jsx(W,{className:"w-4 h-4 text-red-500"}),refund:e.jsx(p,{className:"w-4 h-4 text-blue-500"}),credit:e.jsx(R,{className:"w-4 h-4 text-green-500"})};function F(){const[t,d]=a.useState(null),[r,i]=a.useState([]),[C,f]=a.useState(!0),[g,b]=a.useState(null),[k,y]=a.useState(!1),[c,j]=a.useState(""),[x,N]=a.useState(null),[w,v]=a.useState(!1),[S,D]=a.useState(null);a.useEffect(()=>{u()},[]);async function u(){f(!0),b(null);try{const[s,n]=await Promise.all([o("/wallet"),o("/wallet/transactions")]);d(s.data||s),i((n.data||n.transactions||[]).slice(0,50))}catch(s){b(s.message)}finally{f(!1)}}async function T(){if(!(!c||Number(c)<=0)){v(!0);try{const s=await o("/wallet/deposit",{method:"POST",body:JSON.stringify({amount:Number(c)})});N(s.data||s),j("")}catch(s){alert("Failed to create deposit: "+s.message)}finally{v(!1)}}}async function P(s){if(confirm("Request a refund for this transaction?")){D(s);try{await o(`/wallet/refund/${s}`,{method:"POST"}),alert("Refund requested successfully"),u()}catch(n){alert("Refund request failed: "+n.message)}finally{D(null)}}}if(C)return e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})});if(g)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:g});const _=(t==null?void 0:t.balance)||0,h=r.filter(s=>s.type==="debit"||Number(s.amount)<0).slice(0,7).reverse(),B=Math.max(...h.map(s=>Math.abs(s.amount)),1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(q,{className:"w-7 h-7 text-primary-600"})," Wallet"]}),e.jsx("button",{onClick:u,className:"text-gray-500 hover:text-gray-700",children:e.jsx(p,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 rounded-xl p-6 text-white shadow-lg",children:[e.jsx("p",{className:"text-sm opacity-80",children:"Current Balance"}),e.jsx("p",{className:"text-4xl font-bold mt-1",children:l(_)}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:()=>{y(!0),N(null)},className:"bg-white text-primary-700 px-4 py-2 rounded-lg font-semibold hover:bg-primary-50 transition flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"})," Add Credits"]})})]}),k&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Add Credits"}),e.jsx("button",{onClick:()=>y(!1),className:"text-gray-400 hover:text-gray-600 text-xl",children:"×"})]}),x?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"font-semibold text-green-800 mb-2",children:"Transfer the funds to:"}),e.jsxs("div",{className:"text-sm space-y-1 text-green-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Bank:"})," ",m.bank]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Account Name:"})," ",m.accountName]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Account Number:"})," ",m.accountNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Branch:"})," ",m.branch]}),e.jsxs("p",{className:"mt-2",children:[e.jsx("span",{className:"font-medium",children:"Reference:"})," ",e.jsx("span",{className:"bg-green-100 px-2 py-0.5 rounded font-mono text-green-900",children:x.reference||x.id||"—"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use the reference above so we can match your payment. Credits will be added once confirmed by admin."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Amount (PGK)"}),e.jsx("input",{type:"number",min:"1",value:c,onChange:s=>j(s.target.value),placeholder:"e.g. 500",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}),e.jsx("button",{onClick:T,disabled:w||!c,className:"w-full bg-primary-600 text-white py-2 rounded-lg font-semibold hover:bg-primary-700 disabled:opacity-50 transition",children:w?"Processing…":"Get Bank Details"})]})]}),h.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2 mb-3",children:[e.jsx(L,{className:"w-4 h-4"})," Recent Usage"]}),e.jsx("div",{className:"flex items-end gap-2 h-24",children:h.map((s,n)=>{const $=Math.abs(s.amount)/B*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-full bg-red-400 rounded-t",style:{height:`${Math.max($,4)}%`},title:l(Math.abs(s.amount))}),e.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(s.created_at).toLocaleDateString("en",{day:"numeric",month:"short"})})]},n)})})]}),r.filter(s=>s.status==="pending"&&s.type==="deposit").length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-yellow-800 flex items-center gap-2 mb-2",children:[e.jsx(M,{className:"w-4 h-4"})," Pending Deposits"]}),e.jsx("ul",{className:"space-y-1 text-sm text-yellow-700",children:r.filter(s=>s.status==="pending"&&s.type==="deposit").map(s=>e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{children:[l(s.amount)," — Ref: ",s.reference||s.id]}),e.jsx("span",{children:A(s.created_at)})]},s.id))})]}),r.filter(s=>s.status==="refund_pending"||s.type==="refund_request").length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-blue-800 flex items-center gap-2 mb-2",children:[e.jsx(p,{className:"w-4 h-4"})," Refund Requests"]}),e.jsx("ul",{className:"space-y-1 text-sm text-blue-700",children:r.filter(s=>s.status==="refund_pending"||s.type==="refund_request").map(s=>e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{children:[l(Math.abs(s.amount))," — ",s.description||"Refund requested"]}),e.jsx("span",{className:"text-blue-500",children:"Pending review"})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:[e.jsx("h3",{className:"px-4 py-3 font-semibold text-gray-800 border-b border-gray-100",children:"Transaction History"}),r.length===0?e.jsx("p",{className:"p-4 text-gray-500 text-sm",children:"No transactions yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Type"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Balance"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Description"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:r.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-500",children:A(s.created_at)}),e.jsxs("td",{className:"px-4 py-2 flex items-center gap-1 capitalize",children:[I[s.type]||null," ",s.type]}),e.jsxs("td",{className:`px-4 py-2 text-right font-medium ${Number(s.amount)>=0?"text-green-600":"text-red-600"}`,children:[Number(s.amount)>=0?"+":"",l(s.amount)]}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-600",children:s.running_balance!=null?l(s.running_balance):"—"}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:s.description||"—"}),e.jsx("td",{className:"px-4 py-2",children:s.type==="debit"&&s.status!=="refund_pending"&&e.jsx("button",{onClick:()=>P(s.id),disabled:S===s.id,className:"text-xs text-blue-600 hover:underline disabled:opacity-50",children:S===s.id?"…":"Refund"})})]},s.id))})]})})]})]})}export{F as default};
