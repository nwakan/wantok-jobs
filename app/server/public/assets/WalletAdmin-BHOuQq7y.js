import{j as e,aT as I,R as j,U as _,p as B,ap as R,S as E,x as A,aA as W}from"./vendor-ui-K43rUeTs.js";import{r}from"./vendor-react-Dlyf-RJj.js";const L="/api";async function d(t,c={}){const n=localStorage.getItem("token"),l=await fetch(`${L}${t}`,{...c,headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json",...c.headers}});if(!l.ok)throw new Error(`API error ${l.status}`);return l.json()}function p(t){return`K${Number(t||0).toFixed(2)}`}function C(t){return t?new Date(t).toLocaleDateString("en-PG",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function u({icon:t,label:c,value:n,color:l="primary"}){return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(t,{className:`w-5 h-5 text-${l}-600`}),e.jsx("span",{className:"text-sm text-gray-600",children:c})]}),e.jsx("p",{className:`text-2xl font-bold text-${l}-700`,children:n})]})}function K(){const[t,c]=r.useState(null),[n,l]=r.useState([]),[g,D]=r.useState([]),[P,b]=r.useState(!0),[N,w]=r.useState(null),[y,T]=r.useState(""),[i,f]=r.useState(null),[v,S]=r.useState(!1),[o,x]=r.useState(null);r.useEffect(()=>{m()},[]);async function m(){b(!0),w(null);try{const[s,a,h]=await Promise.all([d("/wallet/admin/stats"),d("/wallet/admin/deposits"),d("/wallet/admin/refunds")]);c(s.data||s),l(a.data||a.deposits||[]),D(h.data||h.refunds||[])}catch(s){w(s.message)}finally{b(!1)}}async function k(s){x(`match-${s}`);try{await d(`/wallet/admin/deposits/${s}/match`,{method:"POST"}),m()}catch(a){alert("Match failed: "+a.message)}finally{x(null)}}async function $(s,a){x(`${a}-${s}`);try{await d(`/wallet/admin/refunds/${s}/${a}`,{method:"POST"}),m()}catch(h){alert(`${a} failed: `+h.message)}finally{x(null)}}async function U(s){if(s.preventDefault(),!!y.trim()){S(!0),f(null);try{const a=await d(`/wallet/admin/stats?search=${encodeURIComponent(y.trim())}`);f(a.data||a)}catch{f({error:"Not found"})}finally{S(!1)}}}return P?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):N?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:N}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(I,{className:"w-7 h-7 text-primary-600"})," Wallet Admin"]}),e.jsx("button",{onClick:m,className:"text-gray-500 hover:text-gray-700",children:e.jsx(j,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(u,{icon:_,label:"Total Wallets",value:(t==null?void 0:t.totalWallets)??"—"}),e.jsx(u,{icon:B,label:"Total Balance",value:p(t==null?void 0:t.totalBalance),color:"green"}),e.jsx(u,{icon:R,label:"Pending Deposits",value:(t==null?void 0:t.pendingDeposits)??"—",color:"yellow"}),e.jsx(u,{icon:j,label:"Pending Refunds",value:(t==null?void 0:t.pendingRefunds)??"—",color:"blue"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("form",{onSubmit:U,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(E,{className:"absolute left-3 top-2.5 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:y,onChange:s=>T(s.target.value),placeholder:"Search wallet by email or user ID…",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsx("button",{type:"submit",disabled:v,className:"bg-primary-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-primary-700 disabled:opacity-50",children:v?"…":"Search"})]}),i&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded text-sm",children:i.error?e.jsx("p",{className:"text-red-600",children:i.error}):e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"User:"})," ",i.email||i.userId||"—"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Balance:"})," ",p(i.balance)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total Transactions:"})," ",i.totalTransactions??"—"]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("h3",{className:"px-4 py-3 font-semibold text-gray-800 border-b border-gray-100 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-yellow-500"})," Pending Deposits (",n.length,")"]}),n.length===0?e.jsx("p",{className:"p-4 text-gray-500 text-sm",children:"No pending deposits."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"User"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Reference"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:n.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:s.email||s.user_email||s.user_id||"—"}),e.jsx("td",{className:"px-4 py-2 text-right font-medium text-green-600",children:p(s.amount)}),e.jsx("td",{className:"px-4 py-2 font-mono text-xs",children:s.reference||s.id}),e.jsx("td",{className:"px-4 py-2 text-gray-500",children:C(s.created_at)}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("button",{onClick:()=>k(s.id),disabled:o===`match-${s.id}`,className:"bg-green-600 text-white px-3 py-1 rounded text-xs font-medium hover:bg-green-700 disabled:opacity-50 flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"})," ",o===`match-${s.id}`?"…":"Match"]})})]},s.id))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("h3",{className:"px-4 py-3 font-semibold text-gray-800 border-b border-gray-100 flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-blue-500"})," Pending Refunds (",g.length,")"]}),g.length===0?e.jsx("p",{className:"p-4 text-gray-500 text-sm",children:"No pending refunds."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"User"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Reason"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:g.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:s.email||s.user_email||s.user_id||"—"}),e.jsx("td",{className:"px-4 py-2 text-right font-medium",children:p(Math.abs(s.amount))}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:s.description||s.reason||"—"}),e.jsx("td",{className:"px-4 py-2 text-gray-500",children:C(s.created_at)}),e.jsxs("td",{className:"px-4 py-2 flex gap-2",children:[e.jsxs("button",{onClick:()=>$(s.id,"approve"),disabled:!!o,className:"bg-green-600 text-white px-3 py-1 rounded text-xs font-medium hover:bg-green-700 disabled:opacity-50 flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"})," Approve"]}),e.jsxs("button",{onClick:()=>$(s.id,"reject"),disabled:!!o,className:"bg-red-600 text-white px-3 py-1 rounded text-xs font-medium hover:bg-red-700 disabled:opacity-50 flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"})," Reject"]})]})]},s.id))})]})})]})]})}export{K as default};
