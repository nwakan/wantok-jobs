import{r,$ as b,ag as c,j as e}from"./index-BpglRmhx.js";function f(){const[l,n]=r.useState([]),[t,x]=r.useState(null),[p,u]=r.useState(!0),{showToast:o}=b(),[m,d]=r.useState("");r.useEffect(()=>{h()},[]);const h=async()=>{try{const s=await c.getAll();n(s||[])}catch(s){console.error("Failed to load messages:",s),n([{id:1,from_name:"Jane Applicant",subject:"Question about the position",message:"Hi, I would like to know more about the work schedule for this position...",read:!1,created_at:new Date().toISOString(),from_type:"applicant"},{id:2,from_name:"Admin Team",subject:"Your job posting has been approved",message:'Your job posting "Senior Software Engineer" has been reviewed and approved.',read:!0,created_at:new Date(Date.now()-864e5).toISOString(),from_type:"admin"}])}finally{u(!1)}},g=async s=>{if(x(s),d(""),!s.read)try{await c.markRead(s.id),n(l.map(a=>a.id===s.id?{...a,read:!0}:a))}catch(a){console.error("Failed to mark as read:",a)}},y=async s=>{s.preventDefault();try{await c.send({recipient_id:t.from_id,subject:`Re: ${t.subject}`,message:m}),o("Reply sent successfully","success"),d("")}catch{o("Failed to send reply","error")}},i=l.filter(s=>!s.read).length;return p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Messages"}),i>0&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[i," unread message",i!==1?"s":""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"divide-y divide-gray-200",children:l.length===0?e.jsx("p",{className:"p-6 text-center text-gray-500",children:"No messages"}):l.map(s=>e.jsxs("div",{onClick:()=>g(s),className:`p-4 cursor-pointer transition-colors ${s.read?"hover:bg-gray-50":"bg-blue-50"} ${(t==null?void 0:t.id)===s.id?"bg-gray-100":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("p",{className:`font-semibold text-sm ${s.read?"text-gray-700":"text-gray-900"}`,children:s.from_name}),!s.read&&e.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full"})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:s.subject}),e.jsx("p",{className:"text-xs text-gray-500 truncate mb-1",children:s.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s.from_type==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:s.from_type==="admin"?"Admin":"Applicant"}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleDateString()})]})]},s.id))})}),e.jsx("div",{className:"lg:col-span-2 bg-white rounded-lg shadow-sm p-6",children:t?e.jsxs("div",{children:[e.jsxs("div",{className:"border-b pb-4 mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:t.subject}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:t.from_name}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:new Date(t.created_at).toLocaleString()}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.from_type==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:t.from_type==="admin"?"Admin":"Applicant"})]})]}),e.jsx("div",{className:"prose max-w-none mb-6",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:t.message})}),t.from_type!=="admin"&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Reply"}),e.jsxs("form",{onSubmit:y,children:[e.jsx("textarea",{value:m,onChange:s=>d(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg mb-4",rows:"6",placeholder:"Type your reply here...",required:!0}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Send Reply"})]})]})]}):e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Select a message to view"})})]})]})}export{f as default};
