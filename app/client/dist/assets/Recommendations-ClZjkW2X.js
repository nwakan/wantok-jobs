import{r as i,$ as O,aa as K,a9 as Q,a8 as k,ab as w,j as s,i as m}from"./index-BpglRmhx.js";function H(){const[C,J]=i.useState([]),[L,M]=i.useState(!0),[r,A]=i.useState(null),[x,N]=i.useState("match"),[y,_]=i.useState(new Set),[n,u]=i.useState(new Set),{showToast:c}=O();i.useEffect(()=>{R()},[]);const R=async()=>{try{const[e,a,d,D]=await Promise.all([K.get().catch(()=>null),Q.getAll({limit:50}).catch(()=>({data:[]})),k.getMy().catch(()=>[]),w.getAll().catch(()=>[])]);A(e);const B=new Set((d||[]).map(t=>t.job_id)),F=new Set((D||[]).map(t=>t.id));_(B),u(F);let g=[],f="",b="";if(e!=null&&e.profile)try{g=e.profile.skills?JSON.parse(e.profile.skills):[],f=e.profile.location||"",b=e.profile.desired_job_type||""}catch(t){console.error("Parse error:",t)}const z=(a.data||[]).map(t=>{var j;let l=60;const o=[];if(g.length>0){const v=(t.title||"").toLowerCase(),E=(t.description||"").toLowerCase(),h=g.filter(S=>v.includes(S.toLowerCase())||E.includes(S.toLowerCase()));h.length>0&&(l+=Math.min(h.length*8,25),o.push(`${h.length} skill${h.length>1?"s":""} match your profile`))}if(f&&t.location&&t.location.toLowerCase().includes(f.toLowerCase())&&(l+=10,o.push("Location matches your preference")),b&&t.type&&t.type.toLowerCase()===b.toLowerCase()&&(l+=5,o.push("Job type matches your preference")),(j=e==null?void 0:e.profile)!=null&&j.desired_salary_min&&t.salary_min){const v=parseInt(e.profile.desired_salary_min);t.salary_min>=v&&(l+=5,o.push("Salary meets your expectations"))}return(Date.now()-new Date(t.created_at||t.posted_at).getTime())/(1e3*60*60*24)<7&&(l+=3),l+=Math.floor(Math.random()*10)-5,l=Math.min(l,99),o.length===0&&(o.push("Based on your profile"),o.push("Popular in your area")),{...t,match_score:l,match_reasons:o.slice(0,3)}});J(z)}catch(e){console.error("Failed to load recommendations:",e)}finally{M(!1)}},$=async e=>{var a;try{if(!((a=r==null?void 0:r.profile)!=null&&a.cv_url)){c("Please upload your resume in your profile first","error");return}await k.create({job_id:e,cover_letter:"Applied via quick apply. Please see my full profile and resume for details."}),c("Application submitted successfully! ðŸŽ‰","success"),_(new Set([...y,e]))}catch(d){c("Failed to submit application: "+(d.message||"Unknown error"),"error")}},P=async e=>{try{n.has(e)?(await w.unsave(e),u(new Set([...n].filter(a=>a!==e))),c("Job removed from saved","success")):(await w.save(e),u(new Set([...n,e])),c("Job saved! ðŸ’¾","success"))}catch{c("Failed to save job","error")}},p=[...C].sort((e,a)=>x==="match"?a.match_score-e.match_score:new Date(a.created_at||a.posted_at)-new Date(e.created_at||e.posted_at));if(L)return s.jsx("div",{className:"flex justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});const T=r!=null&&r.profile?r.profile.phone&&r.profile.location&&r.profile.bio&&r.profile.cv_url?100:50:0;return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Job Recommendations"}),s.jsx("p",{className:"text-gray-600",children:"AI-powered job matches based on your profile, skills, and preferences"})]}),T<100&&s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-5 mb-6",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{className:"h-6 w-6 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),s.jsxs("div",{className:"ml-3 flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-yellow-800",children:"Improve your recommendations"}),s.jsxs("p",{className:"mt-1 text-sm text-yellow-700",children:["Complete your profile to get more accurate job matches. Add your skills, experience, and preferences."," ",s.jsx(m,{to:"/dashboard/jobseeker/profile",className:"font-semibold underline hover:text-yellow-900",children:"Complete profile â†’"})]})]})]})}),s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",s.jsx("span",{className:"font-semibold",children:p.length})," recommended jobs"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>N("match"),className:`px-4 py-2 rounded-lg text-sm font-medium transition ${x==="match"?"bg-primary-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"ðŸŽ¯ Best Match"}),s.jsx("button",{onClick:()=>N("date"),className:`px-4 py-2 rounded-lg text-sm font-medium transition ${x==="date"?"bg-primary-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"ðŸ“… Most Recent"})]})]}),p.length===0?s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[s.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”"}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No recommendations available yet"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Complete your profile to help us find the perfect jobs for you"}),s.jsx(m,{to:"/dashboard/jobseeker/profile",className:"inline-block px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-medium",children:"Complete Profile"})]}):s.jsx("div",{className:"space-y-5",children:p.map(e=>s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 hover:border-primary-500 hover:shadow-md transition p-6",children:[s.jsx("div",{className:"flex justify-between items-start mb-4",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(m,{to:`/jobs/${e.id}`,className:"text-xl font-bold text-gray-900 hover:text-primary-600",children:e.title}),s.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${e.match_score>=90?"bg-green-100 text-green-800":e.match_score>=80?"bg-blue-100 text-blue-800":e.match_score>=70?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:[e.match_score,"% Match"]}),y.has(e.id)&&s.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-semibold bg-green-100 text-green-800",children:"âœ“ Applied"})]}),s.jsx("p",{className:"text-gray-700 font-medium mb-3",children:e.company_name}),s.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 mb-4",children:[s.jsxs("span",{children:["ðŸ“ ",e.location]}),s.jsxs("span",{children:["ðŸ’¼ ",e.type]}),e.salary_min&&e.salary_max&&s.jsxs("span",{children:["ðŸ’° K",e.salary_min.toLocaleString()," - K",e.salary_max.toLocaleString()]}),s.jsxs("span",{className:"text-xs text-gray-500",children:["Posted ",Math.floor((Date.now()-new Date(e.created_at||e.posted_at).getTime())/(1e3*60*60*24))," days ago"]})]}),e.match_reasons&&e.match_reasons.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Why this is a great match:"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:e.match_reasons.map((a,d)=>s.jsxs("span",{className:"text-xs px-3 py-1 bg-blue-50 text-blue-700 rounded-full font-medium",children:["âœ“ ",a]},d))})]}),e.description&&s.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description})]})}),s.jsxs("div",{className:"flex gap-2 items-center",children:[y.has(e.id)?s.jsx("button",{disabled:!0,className:"px-5 py-2 bg-gray-300 text-gray-600 rounded-lg cursor-not-allowed font-medium",children:"âœ“ Applied"}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>$(e.id),className:"px-5 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-medium transition",children:"âš¡ Quick Apply"}),s.jsx(m,{to:`/jobs/${e.id}`,className:"px-5 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium transition",children:"View Details"})]}),s.jsx("button",{onClick:()=>P(e.id),className:`px-4 py-2 rounded-lg font-medium transition ${n.has(e.id)?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:n.has(e.id)?"Saved":"Save for later",children:n.has(e.id)?"ðŸ’¾ Saved":"ðŸ”– Save"})]})]},e.id))}),p.length>0&&s.jsx("div",{className:"text-center py-8",children:s.jsxs("p",{className:"text-gray-600 text-sm",children:["That's all for now! Check back later for more recommendations or"," ",s.jsx(m,{to:"/jobs",className:"text-primary-600 hover:text-primary-700 font-medium underline",children:"browse all jobs"})]})})]})}export{H as default};
